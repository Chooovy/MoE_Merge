
Mixtral
PPL after evaluation: {'wikitext2': 3.986114501953125}
Average Allocated Memory: 100643.77 MiB
Average Reserved Memory: 119129.82 MiB
Total number of parameters: 46.70B
Number of trainable parameters: 46.70B
Number of non-trainable parameters: 0.00B

Mixtral mean expert

PPL after evaluation: {'wikitext2': 800.7800903320312}
Average Allocated Memory: 25437.96 MiB
Average Reserved Memory: 160404.18 MiB
Total number of parameters: 7.24B
Number of trainable parameters: 7.24B
Number of non-trainable parameters: 0.00B


ratio=1.0
PPL after evaluation: {'wikitext2': 4.567188739776611}
Average Allocated Memory: 100649.59 MiB
Average Reserved Memory: 119863.64 MiB
Total number of parameters: 46.70B
Number of trainable parameters: 46.70B
Number of non-trainable parameters: 0.00B

ratio=0.5
Experiment: Mixtral_ratio-0.5
PPL after evaluation: {'wikitext2': 7.217347621917725}
Average Allocated Memory: 100649.59 MiB
Average Reserved Memory: 120414.55 MiB
Total number of parameters: 46.70B
Number of trainable parameters: 46.70B
Number of non-trainable parameters: 0.00B

shareU 0.5
Experiment: Mixtral-8x7B-v0.1-delta-0.5-share-1
PPL after evaluation: {'wikitext2': 20.796749114990234}
Average Allocated Memory: 46148.97 MiB
Average Reserved Memory: 202342.18 MiB
Total number of parameters: 29.78B
Number of trainable parameters: 29.78B
Number of non-trainable parameters: 0.00B

shareV 0.5
Experiment: Mixtral-8x7B-v0.1-delta-0.5-share-1
PPL after evaluation: {'wikitext2': 21.802478790283203}
Average Allocated Memory: 139129.65 MiB
Average Reserved Memory: 202582.18 MiB
Total number of parameters: 29.78B
Number of trainable parameters: 29.78B
Number of non-trainable parameters: 0.00B

shareV 1
Experiment: Mixtral-8x7B-v0.1-delta-1-share-1
PPL after evaluation: {'wikitext2': 8.259197235107422}
Average Allocated Memory: 166812.90 MiB
Average Reserved Memory: 229638.18 MiB
Total number of parameters: 52.33B
Number of trainable parameters: 52.33B
Number of non-trainable parameters: 0.00B

ratio=0.1
PPL after evaluation: {'wikitext2': 29.03373146057129}
Average Allocated Memory: 100649.59 MiB
Average Reserved Memory: 120983.64 MiB
Total number of parameters: 46.70B
Number of trainable parameters: 46.70B
Number of non-trainable parameters: 0.00B


mean average
/aifs4su/lilujun/SVD-MoE-merge/MoE/Mixtral-8x7B_0.25_svd_delta_merged.pt
Experiment: Mixtral-8x7B-ratio-0.25
PPL after evaluation: {'wikitext2': 12.589655876159668}
Average Allocated Memory: 46894.76 MiB
Average Reserved Memory: 116025.82 MiB
Total number of parameters: 18.51B
Number of trainable parameters: 18.51B
Number of non-trainable parameters: 0.00B
18.51B/46.70B = 0.39 --- 60% cut


freq average
Experiment: Mixtral-8x7B-v0.1-delta-0.25-share-1
PPL after evaluation: {'wikitext2': 11.93613052368164}
Average Allocated Memory: 132966.15 MiB
Average Reserved Memory: 165070.91 MiB
Total number of parameters: 18.51B
Number of trainable parameters: 18.51B
Number of non-trainable parameters: 0.00B


mean average
/aifs4su/lilujun/SVD-MoE-merge/MoE/Mixtral-8x7B_0.5_svd_delta_merged.pt
Experiment: Mixtral-8x7B-ratio-0.5
PPL after evaluation: {'wikitext2': 6.85538911819458}
Average Allocated Memory: 68415.59 MiB
Average Reserved Memory: 99301.82 MiB
Total number of parameters: 29.78B
Number of trainable parameters: 29.78B
Number of non-trainable parameters: 0.00B
29.78B/46.70B = 0.63 --- 40% cut


freq average
Experiment: Mixtral-8x7B-v0.1-delta-0.5-share-1
PPL after evaluation: {'wikitext2': 6.766188621520996}
Average Allocated Memory: 154477.48 MiB
Average Reserved Memory: 185893.09 MiB
Total number of parameters: 29.78B
Number of trainable parameters: 29.78B
Number of non-trainable parameters: 0.00B


Baseline
svd mean weight no scale
28min
Experiment: Mixtral-8x7B-v0.1-delta-1-share-1
PPL after evaluation: {'wikitext2': 5.117525577545166}
Average Allocated Memory: 122283.23 MiB
Average Reserved Memory: 235066.00 MiB
Total number of parameters: 52.33B
Number of trainable parameters: 52.33B
Number of non-trainable parameters: 0.00B









----------------------------------------------------------------

SmolLlamix-8x101M

PPL after evaluation: {'wikitext2': 26.390592575073242}
Average Allocated Memory: 8128.93 MiB
Average Reserved Memory: 15292.55 MiB
Total number of parameters: 0.40B
Number of trainable parameters: 0.40B
Number of non-trainable parameters: 0.00B

----------------------------------------------------------------

SmolLlamix-8x101M mean expert

PPL after evaluation: {'wikitext2': 36.36859893798828}
Average Allocated Memory: 7564.84 MiB
Average Reserved Memory: 16740.00 MiB
Total number of parameters: 0.10B
Number of trainable parameters: 0.10B
Number of non-trainable parameters: 0.00B

差不多
Experiment: SmolLlamix-8x101M
PPL after evaluation: {'wikitext2': 36.355106353759766}
Average Allocated Memory: 8128.93 MiB
Average Reserved Memory: 15803.45 MiB
Total number of parameters: 0.40B
Number of trainable parameters: 0.40B
Number of non-trainable parameters: 0.00B

ratio=1.0
PPL after evaluation: {'wikitext2': 26.585735321044922}
Average Allocated Memory: 8163.84 MiB
Average Reserved Memory: 20620.91 MiB
Total number of parameters: 0.40B
Number of trainable parameters: 0.40B
Number of non-trainable parameters: 0.00B

ratio=0.1
Experiment: SmolLlamix-8x101M_0.1
PPL after evaluation: {'wikitext2': 31.862152099609375}
Average Allocated Memory: 8163.84 MiB
Average Reserved Memory: 20648.18 MiB
Total number of parameters: 0.40B
Number of trainable parameters: 0.40B
Number of non-trainable parameters: 0.00B

ratio=0.5
Experiment: SmolLlamix-8x101M_ratio-0.5
PPL after evaluation: {'wikitext2': 27.76469612121582}
Average Allocated Memory: 8163.84 MiB
Average Reserved Memory: 20620.91 MiB
Total number of parameters: 0.40B
Number of trainable parameters: 0.40B
Number of non-trainable parameters: 0.00B

---------------------------------------------------------------
shareV not shareU
Experiment: Mixtral-8x7B-delta-0.5-share-1-sparsity-1
PPL after evaluation: {'wikitext2': 6.888123512268066}
Average Allocated Memory: 139061.36 MiB
Average Reserved Memory: 248370.18 MiB
Number of non-zero parameters: 21.74B
Compression ratio: 0.53%
Save ratio: 0.47%

shareV ,shareU-use average U
Experiment: Mixtral-8x7B-delta-0.5-share-1-sparsity-1
PPL after evaluation: {'wikitext2': 139.15591430664062}
Average Allocated Memory: 139061.36 MiB
Average Reserved Memory: 248370.18 MiB
Number of non-zero parameters: 10.06B
Compression ratio: 0.78%
Save ratio: 0.22%

shareV ,shareU-use single U
Experiment: Mixtral-8x7B-delta-0.5-share-1-sparsity-1
PPL after evaluation: {'wikitext2': 1864.86669921875}
Average Allocated Memory: 116774.23 MiB
Average Reserved Memory: 221058.18 MiB
Number of non-zero parameters: 9.95B
Compression ratio: 0.79%
Save ratio: 0.21%

shareV sparse-0.2
Experiment: Mixtral-8x7B-delta-0.5-share-1
PPL after evaluation: {'wikitext2': 9.455763816833496}
Average Allocated Memory: 53294.47 MiB
Average Reserved Memory: 90002.18 MiB
Number of non-zero parameters: 18.92B
Compression ratio: 0.59%
Save ratio: 0.41%

no shareV no shareU
Experiment: Mixtral-8x7B-delta-0.5-share-1
PPL after evaluation: {'wikitext2': 5.073697090148926}
Average Allocated Memory: 154395.69 MiB
Average Reserved Memory: 195772.00 MiB
Number of non-zero parameters: 29.77B
Compression ratio: 0.36%
Save ratio: 0.64%

no shareV no shareU sparse-0.2
Experiment: Mixtral-8x7B-delta-0.5-share-1-sparsity-0.2
PPL after evaluation: {'wikitext2': 5.973724842071533}
Average Allocated Memory: 68379.69 MiB
Average Reserved Memory: 109483.09 MiB
Number of non-zero parameters: 26.95B
Compression ratio: 0.42%
Save ratio: 0.58%
---------------------------------------------------------------
(svd-moe) root@C.14144282:/workspace/guhao_workspace/MoE_Merge$ python SVDWmerge_shareUV.py                                                                      
对meanW作SVD就是不好                                                                                                                                                           
Experiment: Mixtral-8x7B-delta-0.5-share-0.5-sparsity-1                                                                                                          
PPL after evaluation: {'wikitext2': 15.853096008300781}                                                                                                          
Average Allocated Memory: 47680.09 MiB                                                                                                                           
Average Reserved Memory: 252464.00 MiB                                                                                                                           
Number of non-zero parameters: 18.92B                                                                                                                            
Compression ratio: 0.59%                                                                                                                                         
Save ratio: 0.41%                                                                                                                                                
                                                                                                                                                                 
(svd-moe) root@C.14144282:/workspace/guhao_workspace/MoE_Merge$ python SVDWmerge_shareUV.py                                                                      
                                                                                                                                               
Experiment: Mixtral-8x7B-delta-0.5-share-0.8-sparsity-1                                                                                                          
PPL after evaluation: {'wikitext2': 10.653851509094238}                                                                                                          
Average Allocated Memory: 50894.73 MiB                                                                                                                           
Average Reserved Memory: 260226.91 MiB                                                                                                                           
Number of non-zero parameters: 20.61B                                                                                                                            
Compression ratio: 0.56%                                                                                                                                         
Save ratio: 0.44% 